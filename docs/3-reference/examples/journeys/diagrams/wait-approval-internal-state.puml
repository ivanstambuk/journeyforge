@startuml
!include journey-diagram-theme.puml
' Internal DSL state graph for wait-approval
title wait-approval â€“ internal DSL state graph

[*] --> submit

state submit
state waitForApproval
state ingestWaitForApproval
state routeWaitForApproval
state finish
state rejected

submit --> waitForApproval : task httpCall\noperationRef items.createItem

waitForApproval --> ingestWaitForApproval : submit step
ingestWaitForApproval --> routeWaitForApproval
routeWaitForApproval --> finish : context.payload.decision == 'approved'
routeWaitForApproval --> rejected : default

finish --> [*]
rejected --> [*]

note right of waitForApproval
  type: wait (manual channel)
  input: approval payload { decision, comment }
  response.outputVar: stepResponse
  engine copies validated payload to context.payload
end note

@enduml
