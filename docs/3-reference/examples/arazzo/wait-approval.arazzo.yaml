arazzo: 1.0.1
info:
  title: JourneyForge â€“ wait-approval workflows
  version: 0.1.0
  summary: Workflows for manual approval over the wait-approval journey.
sourceDescriptions:
  - name: waitApproval
    type: openapi
    url: ../oas/wait-approval.openapi.yaml
workflows:
  wait-approval-happy-path:
    summary: Start a wait-approval journey, approve, and read the final result.
    sourceDescriptions:
      - waitApproval
    inputs:
      startRequest:
        description: Initial payload for the wait-approval journey.
        schema:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: string
            name:
              type: string
          additionalProperties: true
      approvalInput:
        description: Manual approval decision (approved).
        schema:
          type: object
          required:
            - decision
          properties:
            decision:
              type: string
              enum:
                - approved
            comment:
              type: string
          additionalProperties: false
    steps:
      - name: startJourney
        description: Start a new wait-approval journey instance.
        call:
          source: waitApproval
          operationId: waitApproval_start
        parameters:
          requestBody: $inputs.startRequest
        outputs:
          journeyId: $response.body.journeyId
      - name: provideApproval
        description: Provide an approved decision to the waitForApproval step.
        call:
          source: waitApproval
          operationId: waitApproval_waitForApproval
        parameters:
          path:
            journeyId: $steps.startJourney.outputs.journeyId
          requestBody: $inputs.approvalInput
        outputs:
          phase: $response.body.phase
      - name: getResult
        description: Retrieve the final outcome after approval.
        call:
          source: waitApproval
          operationId: waitApproval_getResult
        parameters:
          path:
            journeyId: $steps.startJourney.outputs.journeyId

  wait-approval-rejected:
    summary: Start a wait-approval journey, reject, and read the failure outcome.
    sourceDescriptions:
      - waitApproval
    inputs:
      startRequest:
        description: Initial payload for the wait-approval journey.
        schema:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: string
            name:
              type: string
          additionalProperties: true
      rejectionInput:
        description: Manual approval decision (rejected).
        schema:
          type: object
          required:
            - decision
          properties:
            decision:
              type: string
              enum:
                - rejected
            comment:
              type: string
          additionalProperties: false
    steps:
      - name: startJourney
        description: Start a new wait-approval journey instance.
        call:
          source: waitApproval
          operationId: waitApproval_start
        parameters:
          requestBody: $inputs.startRequest
        outputs:
          journeyId: $response.body.journeyId
      - name: provideRejection
        description: Provide a rejected decision to the waitForApproval step.
        call:
          source: waitApproval
          operationId: waitApproval_waitForApproval
        parameters:
          path:
            journeyId: $steps.startJourney.outputs.journeyId
          requestBody: $inputs.rejectionInput
        outputs:
          phase: $response.body.phase
      - name: getResult
        description: Retrieve the final (failed) outcome after rejection.
        call:
          source: waitApproval
          operationId: waitApproval_getResult
        parameters:
          path:
            journeyId: $steps.startJourney.outputs.journeyId

