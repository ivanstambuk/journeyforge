@startuml
!include journey-diagram-theme.puml
title market-open-order-submission â€“ client activity flow

start

:Client sends\nPOST /api/v1/journeys/market-open-order-submission/start\nwith MarketOpenOrderStartRequest;

repeat
  :Client calls\nGET /api/v1/journeys/{journeyId}/result;
  :Journeys API returns\nJourneyOutcome with phase/output;
repeat while (phase == "RUNNING") is (waiting or submitting)

if (phase == "RUNNING" and pre-open window active?) then (pre-open)
  :Client may submit pre-open action\nPOST /journeys/{journeyId}/steps/preOpenAction\n(action: submit or cancel);
endif

if (phase == "SUCCEEDED" and finalStatus == "SUBMITTED"?) then (submitted)
  :Client records submitted order and\nsubmissionMode (IMMEDIATE or DEFERRED);
  stop
else (not submitted / failed)
  :Client handles NOT_SUBMITTED or FAILED\nbased on failureReason and submissionMode;
  stop
endif

@enduml
