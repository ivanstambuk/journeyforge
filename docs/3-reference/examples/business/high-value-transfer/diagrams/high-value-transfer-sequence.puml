@startuml
!include journey-diagram-theme.puml
title high-value-transfer â€“ checks, approval, settlement sequence

actor "Client" as Client
actor "Operator UI" as Operator
actor "Settlement system" as Settlement
participant "Journeys API" as Journeys

Client -> Journeys: POST /api/v1/journeys/high-value-transfer/start\nHighValueTransferStartRequest
Journeys -> Journeys: Run initial fraud and sanctions checks
Journeys --> Client: 200 OK\nJourneyStatus (phase, currentState)

note over Client, Operator
  Client and operator may discuss the high-value transfer
  outside of the journey before the operator records
  the approval/rejection in the Operator UI.
end note

Operator -> Journeys: POST /api/v1/journeys/{journeyId}/steps/approveTransfer\nApproveTransferInput
Journeys --> Operator: 200 OK\nApproveTransferStepResponse

Client -> Journeys: GET /api/v1/journeys/{journeyId}\n(getStatusAwaitingSettlement)
Journeys --> Client: 200 OK\nJourneyStatus (awaiting settlement or timeout)

alt Settlement callback arrives within 30 minutes
  Settlement -> Journeys: POST /api/v1/journeys/{journeyId}/steps/waitForSettlement\n(secured with X-Settlement-Secret)
  Journeys --> Settlement: 200 OK\n(settlement callback accepted)
else No settlement callback within 30 minutes
  note over Journeys
    Internal settlement timer (PT30M) fires, the journey calls
    transfers.notifySettlementTimeout to record the SLA breach,
    and then completes as FAILED with a settlement-timeout error.
  end note
end

Client -> Journeys: GET /api/v1/journeys/{journeyId}/result\n(getResult)
Journeys --> Client: 200 OK\nJourneyOutcome (SETTLED, FAILED, or REJECTED)

@enduml
