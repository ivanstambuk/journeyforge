@startuml
!include journey-diagram-theme.puml
title b2b-purchase-order â€“ client activity flow

start

:Client sends\nPOST /api/v1/journeys/b2b-purchase-order/start\nwith B2bPurchaseOrderStartRequest;

repeat
  :Client calls\nGET /api/v1/journeys/{journeyId}/result;
  :Journeys API returns\nJourneyOutcome with phase/output;
repeat while (phase == "Running" and\ncurrentState != "waitForLevel1Approval") is (creating PO)

if (currentState == "waitForLevel1Approval"?) then (yes)
  :Manager submits level 1 decision\nPOST /api/v1/journeys/{journeyId}/steps/approveLevel1;
endif

if (currentState == "level2ParallelApprovals"?) then (yes)
  :Department head submits decision\nPOST /api/v1/journeys/{journeyId}/steps/approveLevel2Department;
  :Finance submits decision\nPOST /api/v1/journeys/{journeyId}/steps/approveLevel2Finance;
endif

if (currentState == "waitForLevel3Approval"?) then (yes)
  :Board submits level 3 decision\nPOST /api/v1/journeys/{journeyId}/steps/approveLevel3;
endif

if (phase == "Succeeded" and finalStatus == "APPROVED"?) then (approved)
  :Client records approved purchase order\nin ERP or procurement system;
  stop
else (rejected)
  :Client handles REJECTED outcome using\nrejectionCode and rejectionReason;
  stop
endif

@enduml

