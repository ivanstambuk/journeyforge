@startuml
!include journey-diagram-theme.puml
title loan-application â€“ client activity flow

start

:Client sends\nPOST /api/v1/journeys/loan-application/start\nwith LoanApplicationStartRequest;

repeat
  :Client calls\nGET /api/v1/journeys/{journeyId}/result;
  :Journeys API returns\nJourneyOutcome with phase/output;
repeat while (phase == "Running" and\ncurrentState != "waitForUnderwriter") is (checks running)

if (currentState == "waitForUnderwriter"?) then (yes)
  :Underwriter submits decision\nPOST /api/v1/journeys/{journeyId}/steps/underwriterApproval\nwith UnderwriterDecisionInput;
  :Client resumes polling\nGET /api/v1/journeys/{journeyId}/result;
  :Journeys API returns\nJourneyOutcome with updated decision;
endif

if (phase == "Succeeded" and decision == "APPROVED"?) then (approved)
  :Client processes approved terms\n(approvedAmount, interestRate, offerId);
  stop
else (rejected or error)
  :Client handles rejection or error\nbased on decision/rejectionReason;
  stop
endif

@enduml

