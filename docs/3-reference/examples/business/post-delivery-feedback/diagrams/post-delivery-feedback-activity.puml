@startuml
!include journey-diagram-theme.puml
title post-delivery-feedback â€“ client activity flow

start

:Order system sends\nPOST /api/v1/journeys/post-delivery-feedback/start\nwith PostDeliveryFeedbackStartRequest;
:Journeys API returns\nJourneyStatus at waitForDelivery\n(phase = Running);

:Order system calls\nPOST /api/v1/journeys/{journeyId}/steps/confirmDelivery\nwhen delivery or cancellation occurs;
:Journeys API returns\nDeliveryConfirmationStepResponse;

:Order system calls\nGET /api/v1/journeys/{journeyId}/result;
:Journeys API returns\nJourneyOutcome with phase/output;

if (phase == "SUCCEEDED" and finalStatus == "DELIVERED"?) then (delivered)
  :Order system records delivery outcome;\nfeedback request will be handled by\ncompensation after the delay window;
  stop
else (cancelled)
  :Order system records CANCELLED outcome;\nno feedback is sent;
  stop
endif

@enduml
