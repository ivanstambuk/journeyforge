arazzo: 1.0.1
info:
  title: JourneyForge â€“ customer-onboarding-kyc workflows
  version: 0.1.0
  summary: Workflows for customer onboarding with individual KYC checks.
  description: Workflows for starting individual customer onboarding, collecting KYC documents, processing KYC/AML results via webhooks, processing a risk decision, and reading the final approved or rejected outcome.
sourceDescriptions:
  - name: customerOnboarding
    type: openapi
    url: customer-onboarding-kyc.openapi.yaml
workflows:
  - workflowId: customer-onboarding-kyc-approved
    summary: Start an onboarding journey, complete KYC/AML checks, approve risk, and read the approved outcome.
    description: Start a customer-onboarding-kyc journey, let the engine collect KYC documents, accept KYC and AML results via webhooks, accept a risk decision, and then retrieve the APPROVED outcome.
    inputs:
      type: object
      properties:
        startRequest:
          description: Initial customer onboarding request with basic identity data.
          type: object
          required:
            - customerId
            - fullName
            - email
          properties:
            customerId:
              type: string
            fullName:
              type: string
            email:
              type: string
            dateOfBirth:
              type: string
              format: date
            nationality:
              type: string
          additionalProperties: true
        kycDocumentsInput:
          description: KYC documents and additional details from the customer.
          type: object
          required:
            - decision
          properties:
            decision:
              type: string
              enum:
                - submit
            notes:
              type: string
          additionalProperties: false
        kycResultInput:
          description: KYC provider result for the customer.
          type: object
          required:
            - customerId
            - status
          properties:
            customerId:
              type: string
            status:
              type: string
              enum:
                - APPROVED
            reasons:
              type: array
              items:
                type: string
          additionalProperties: false
        amlResultInput:
          description: AML provider result for the customer.
          type: object
          required:
            - customerId
            - status
          properties:
            customerId:
              type: string
            status:
              type: string
              enum:
                - CLEAR
            reasons:
              type: array
              items:
                type: string
          additionalProperties: false
        riskDecisionInput:
          description: Risk/compliance decision for the customer.
          type: object
          required:
            - customerId
            - decision
          properties:
            customerId:
              type: string
            decision:
              type: string
              enum:
                - APPROVE
            riskRating:
              type: string
            reason:
              type: string
          additionalProperties: false
    steps:
      - stepId: startJourney
        description: Start a new customer-onboarding-kyc journey instance.
        operationId: customerOnboardingKyc_start
        x-source: customerOnboarding
        requestBody:
          contentType: application/json
          payload: $inputs.startRequest
        outputs:
          journeyId: $response.body.journeyId
      - stepId: getStatusAfterProspect
        description: Poll journey status until the prospect record is created and the journey is waiting for KYC documents.
        operationId: customerOnboardingKyc_getStatus
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
        outputs:
          phase: $response.body.phase
      - stepId: submitKycDocuments
        description: Provide customer KYC documents and additional details.
        operationId: customerOnboardingKyc_submitKycDocuments
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
        requestBody:
          contentType: application/json
          payload: $inputs.kycDocumentsInput
        outputs:
          phase: $response.body.phase
      - stepId: submitKycResult
        description: Provide KYC provider result via webhook.
        operationId: customerOnboardingKyc_waitForKycResult
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
          - name: X-Kyc-Result-Secret
            in: header
            value: "secret"
        requestBody:
          contentType: application/json
          payload: $inputs.kycResultInput
        outputs:
          phase: $response.body.phase
      - stepId: submitAmlResult
        description: Provide AML provider result via webhook.
        operationId: customerOnboardingKyc_waitForAmlResult
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
          - name: X-Aml-Result-Secret
            in: header
            value: "secret"
        requestBody:
          contentType: application/json
          payload: $inputs.amlResultInput
        outputs:
          phase: $response.body.phase
      - stepId: submitRiskDecision
        description: Provide risk/compliance decision via webhook.
        operationId: customerOnboardingKyc_waitForRiskDecision
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
          - name: X-Risk-Decision-Secret
            in: header
            value: "secret"
        requestBody:
          contentType: application/json
          payload: $inputs.riskDecisionInput
        outputs:
          phase: $response.body.phase
      - stepId: getResult
        description: Retrieve the final approved onboarding outcome.
        operationId: customerOnboardingKyc_getResult
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId

  - workflowId: customer-onboarding-kyc-rejected
    summary: Start an onboarding journey and observe a rejection based on KYC, AML, or risk decision.
    description: Start a customer-onboarding-kyc journey where one of the stages (KYC, AML, or risk decision) rejects the customer, then retrieve the REJECTED outcome and inspect the rejection reason.
    inputs:
      type: object
      properties:
        startRequest:
          description: Initial customer onboarding request likely to be rejected.
          type: object
          required:
            - customerId
            - fullName
            - email
          properties:
            customerId:
              type: string
            fullName:
              type: string
            email:
              type: string
          additionalProperties: true
        rejectingRiskDecisionInput:
          description: Risk/compliance decision that rejects the customer.
          type: object
          required:
            - customerId
            - decision
          properties:
            customerId:
              type: string
            decision:
              type: string
              enum:
                - REJECT
            riskRating:
              type: string
            reason:
              type: string
          additionalProperties: false
    steps:
      - stepId: startJourney
        description: Start a new customer-onboarding-kyc journey instance.
        operationId: customerOnboardingKyc_start
        x-source: customerOnboarding
        requestBody:
          contentType: application/json
          payload: $inputs.startRequest
        outputs:
          journeyId: $response.body.journeyId
      - stepId: getStatusAfterProspect
        description: Poll journey status until the prospect record is created and the journey is waiting for KYC documents or checks.
        operationId: customerOnboardingKyc_getStatus
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
        outputs:
          phase: $response.body.phase
      - stepId: submitRejectingRiskDecision
        description: Submit a rejecting risk/compliance decision via webhook.
        operationId: customerOnboardingKyc_waitForRiskDecision
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
          - name: X-Risk-Decision-Secret
            in: header
            value: "secret"
        requestBody:
          contentType: application/json
          payload: $inputs.rejectingRiskDecisionInput
        outputs:
          phase: $response.body.phase
      - stepId: getResult
        description: Retrieve the final rejected onboarding outcome.
        operationId: customerOnboardingKyc_getResult
        x-source: customerOnboarding
        parameters:
          - name: journeyId
            in: path
            value: $steps.startJourney.outputs.journeyId
